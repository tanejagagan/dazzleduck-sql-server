# DazzleDuck Metrics Collector Configuration
# This file uses HOCON format (Human-Optimized Config Object Notation)
# All values can be overridden via environment variables or system properties

# Logging configuration
logging {
    # Root log level
    level = "INFO"

    # Log output pattern
    pattern = "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
}

collector {
    # Whether the collector is enabled
    enabled = true

    # Target endpoints to scrape metrics from (Prometheus format)
    # Can be full URLs or relative paths (when target-prefix is set)
    targets = [
        "/actuator/prometheus"
    ]

    # Optional prefix for target URLs
    # When set, relative target paths will be resolved against this prefix
    # Example: target-prefix = "http://localhost:8080", target = "/actuator/prometheus"
    #          resolves to: "http://localhost:8080/actuator/prometheus"
    target-prefix = "http://localhost:8080"

    # Remote server URL to send collected metrics
    # Metrics are sent as Apache Arrow stream format
    server-url = "http://localhost:8081/ingest"
    base-url = "http://localhost:8081"

    # Path parameter appended to server URL query string
    path = "scraped_metrics"

    # Scrape interval in milliseconds
    # How often to collect metrics from target endpoints
    scrape-interval-ms = 15000

    # Tailing mode settings
    tailing {
        # Flush when buffer reaches this number of metrics
        flush-threshold = 100

        # Maximum time in milliseconds before flushing buffer
        # Even if threshold is not reached
        flush-interval-ms = 5000

        # Maximum metrics to buffer before dropping oldest
        max-buffer-size = 10000
    }

    # HTTP client settings
    http {
        # Connection timeout in milliseconds
        connection-timeout-ms = 5000

        # Read timeout in milliseconds
        read-timeout-ms = 10000

        # Maximum retry attempts for failed sends
        max-retries = 3

        # Initial retry delay in milliseconds (doubles each retry for exponential backoff)
        retry-delay-ms = 1000
    }

    # Collector identity settings
    identity {
        # Unique identifier for this collector instance
        id = "metrics-collector"

        # Human-readable name for this collector
        name = "Metrics Collector"

        # Host identifier (defaults to hostname if empty)
        host = ""
    }

    # Server authentication settings
    auth {
        # Username for server authentication
        username = "admin"

        # Password for server authentication
        password = "admin"
    }

    # HttpProducer settings for sending metrics
    producer {
        # Minimum batch size in bytes before sending
        min-batch-size = 1024

        # Maximum batch size in bytes
        max-batch-size = 16777216

        # Maximum in-memory buffer size in bytes (10 MB)
        max-in-memory-size = 10485760

        # Maximum on-disk buffer size in bytes (1 GB)
        max-on-disk-size = 1073741824
    }
}
